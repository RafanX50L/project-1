<!DOCTYPE html>
<html lang="en">
<head>
	<title>Home</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.png"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/fonts/iconic/css/material-design-iconic-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/fonts/linearicons-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="/vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/select2/select2.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="/vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/slick/slick.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/MagnificPopup/magnific-popup.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/perfect-scrollbar/perfect-scrollbar.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/css/util.css">
	<link rel="stylesheet" type="text/css" href="/css/main.css">
    <style>
        body {
            background-color: #121212;
            color: #fff;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cancel-btn {
            border: 2px solid red;
            padding: 8px 20px;
            border-radius: 25px;
            color: red;
            text-decoration: none;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .cancel-btn:hover {
            color: white; /* Slightly darker red on hover */
            box-shadow: 0 12px 20px rgba(255, 26, 26, 0.4); /* Deeper shadow on hover */
            transform: translateY(-3px); /* Lift effect on hover */
        }

        .welcome{
            margin-top: 10%;
        }
        
        .order-container {
            background-color: #000000;
            color: #fff;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 0 30px rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
            width: 95%;
            max-width: 1400px;
        }
        
        .order-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00ff88, #00a1ff);
        }
        
        .breadcrumb {
            background-color: transparent;
            padding: 0;
            margin-bottom: 20px;
        }
        
        .breadcrumb-item a {
            color: #00ff88;
            text-decoration: none;
        }
        
        .breadcrumb-item.active {
            color: #ffffff;
        }
        
        .product-card {
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .product-image {
            max-width: 200px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .status-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .status-paid {
            background: linear-gradient(45deg, #00ff88, #00a1ff);
            color: black;
        }
        
        .status-pending {
            background: linear-gradient(45deg, #ffd900, #ff6b00);
            color: black;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            height: 100%;
        }
        
        .info-card:hover {
            border-color: rgba(255,255,255,0.3);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .price-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .download-btn {
            border: 2px solid #00ff88;
            padding: 8px 20px;
            border-radius: 25px;
            color: #00ff88;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            background-color: #00ff88;
            color: #000;
        }
        
        .track-btn {
            background: linear-gradient(45deg, #00ff88, #00a1ff);
            border: none;
            padding: 10px 30px;
            border-radius: 25px;
            color: #000;
            font-weight: 500;
            transition: transform 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .track-btn:hover {
            transform: scale(1.05);
        }
        
        .card-title {
            color: #00ff88;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .price-highlight {
            color: #00ff88;
            font-weight: bold;
        }

        @media (max-width: 1200px) {
            .info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>


</head>

<body class="animsition">
	
	<!-- Header -->
	<header>
		<!-- Header desktop -->
		<div class="container-menu-desktop">

			<div class="wrap-menu-desktop" style="background-color: white;">
				<nav class="limiter-menu-desktop container">
					
					<!-- Logo desktop -->		
					<a href="#" class="logo">
						<img src="/images.png" alt="IMG-LOGO">
					</a>

					<!-- Menu desktop -->
					<div class="menu-desktop" >
						<ul class="main-menu" >
							<li>
								<a href="/user/home">Home</a>
							</li>

							<li class="dropdown-container">
								<a href="/user/allProducts" class="dropdown-toggle">All Products</a>
								<ul class="dropdown">
									<% c.forEach(category => { %>
										<li>
											<a href="/<%= category.category_name %>"><%= category.category_name %></a>
										</li>
									<% }) %>
								</ul>
							</li>

							

							<li>
								<a href="/user/about">About</a>
							</li>

							<li>
								<a href="/user/contact">Contact</a>
							</li>
						</ul>
					</div>	

					<!-- Icon header -->
					<div class="wrap-icon-header flex-w flex-r-m">
						<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
							<i class="zmdi zmdi-search"></i>
						</div>

						<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-cart" data-notify="2">
							<i class="zmdi zmdi-shopping-cart"></i>
						</div>

						<a href="#" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti" data-notify="0">
							<i class="zmdi zmdi-favorite-outline"></i>
						</a>
					</div>
				</nav>
			</div>	
		</div>


		
		<!-- Modal Search -->
		<div class="modal-search-header flex-c-m trans-04 js-hide-modal-search">
			<div class="container-search-header">
				<button class="flex-c-m btn-hide-modal-search trans-04 js-hide-modal-search">
					<img src="/images/icons/icon-close2.png" alt="CLOSE">
				</button>

				<form class="wrap-search-header flex-w p-l-15">
					<button class="flex-c-m trans-04">
						<i class="zmdi zmdi-search"></i>
					</button>
					<input class="plh3" type="text" name="search" placeholder="Search...">
				</form>
			</div>
		</div>
	</header>




    <section class="welcome">
        <div class="order-container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/user/home">Home</a></li>
                    <li class="breadcrumb-item"><a href="/user/orderhistory">My orders</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Order details</li>
                </ol>
            </nav>
    
            <div class="row">
                <div class="col-md-6 mb-4">
                    <h2 class="mb-4">Order Details</h2>
                    <div class="summary-card mb-4">
                        <span class="order-id">OrderId: <%= Orders.orderId %></span><br>
                        <strong>Order At:</strong> <%= new Date(Orders.orderDate).toLocaleDateString('en-GB') %><br>
                        <strong>Estimate Delivery:</strong> <span class="delivery-date"> <%= new Date(new Date(Orders.orderDate).setDate(new Date(Orders.orderDate).getDate() + 5)).toLocaleDateString('en-GB') %>
                        </span><br>
                        <% if(Orders.status == 'delivered'){ %>
                            <strong>Invoice:</strong> <br><br>
                            <a href="#" class="download-btn mt-2" id="InvoiceDownload">
                                <i class="bi bi-download"></i> Download Invoice
                            </a>
                        <% } %>
                        <span style="display: none;" id="orderID"><%= Orders._id %></span>

                        <% if (Orders.status == 'Payment pending') { %>
                            <a href="#" id="retyPayment" class="cancel-btn mt-2" style="margin-left: 40%;">
                                <i class="bi bi-download"></i> Retry Payment
                            </a>
                        <% } %>
                        
                        
                        
                    </div>
    
                    <% Items.forEach(Orders=> { %>
                        <div class="product-card">
                            <div class="row align-items-center">
                                <div class="col-md-4">
                                    <img src="/products/<%= Orders.productImage %>" alt="Oxford shirt" class="product-image">
                                </div>
                                <div class="" style="margin-left: 100px;">
                                    <h5><%= Orders.productName %></h5><br>
                                    <p class="price-highlight" style="color: rgb(243, 224, 189); text-decoration: line-through; font-size: smaller">₹<%= Orders.unitPrice %></p> </p>
                                    <p class="price-highlight">₹<%= Orders.offerPrice %></p><br>
                                    <p>Quantity: <%= Orders.quantity %></p></p>
                                </div>
                                <div class="col-md-4" style="margin-left: 75%;">
                                    <p class="price-highlight">Total: <%= (Orders.offerPrice)*Orders.quantity %></p>

                                </div>
                            </div>
                        </div>
                    <% }); %>

                </div>
    
                <div class="col-md-6">
                    <div class="info-grid">
                        <div class="info-card">
                            <h5 class="card-title">Delivery Address</h5>
                            <strong><%= Orders.shippingAddress.name %></strong><br>
                            <strong><%= Orders.shippingAddress.houseNumber %></strong><br>
                            <strong><%= Orders.shippingAddress.street %></strong><br>
                            <strong><%= Orders.shippingAddress.city %> , <%= Orders.shippingAddress.state %> <%= Orders.shippingAddress.zip %></strong><br>
                            <strong><%= Orders.shippingAddress.country %></strong><br>
                            <strong>Phone: <%= Orders.shippingAddress.phone %></strong><br>
                        </div>
                        
    
                        <div class="info-card">
                            <h5 class="card-title">Price details</h5>
                            <div class="price-detail-row">
                                <span>Total price:</span>
                                <span>₹<%=Orders.subtotal %></span>
                            </div>
                            <div class="price-detail-row">
                                <span>Coupon Discount:</span>
                                <span style="color: #ff6b6b">-₹<%=Orders.Coupon_discount %></span>
                            </div>
                            <div class="price-detail-row">
                                <span>Offer Discount:</span>
                                <span style="color: #ff6b6b">-₹<%=Orders.Offer_discount %></span>
                            </div>
                            <div class="price-detail-row">
                                <span>Shipping:</span>
                                <span style="color: #e7f376">+₹<%= Orders.deliveryCharge %></span>
                            </div>
                            <div class="price-detail-row">
                                <strong>Total:</strong>
                                <strong id="totalAmount" class="price-highlight">₹<%=Orders.totalAmount %></strong>
                            </div>
                        </div>
    
                        <div class="info-card">
                            <h5 class="card-title">Payment Method</h5>
                            <span class="status-badge" style="background: rgb(22, 22, 22); "><%=Orders.paymentMethod%></span>
                            <div class="mt-4">
                                <h6 class="mb-3">Payment Status</h6>
                                <span class="status-badge status-paid"><%=Orders.paymentStatus %></span>
                            </div>
                        </div>
    
                        <div class="info-card">
                            <h5 class="card-title">Order Status</h5>
                            <span class="status-badge status-pending"><%=Orders.status %></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>



    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>

    </script>

<script >


        let element=document.querySelector("#InvoiceDownload")
            if(element){
                document.getElementById('InvoiceDownload').addEventListener('click', async function (event) {
                event.preventDefault();
                
                const orderId = document.getElementById('orderID').textContent.replace('$', '').trim();
                console.log('Entered to download invoice');
                
                window.location.href = `/user/downloadInvoice?orderId=${orderId}`;
            });
        }

        document.getElementById('retyPayment').addEventListener('click',async function(event) {
            event.preventDefault();
            const totalAmount = parseFloat(document.getElementById('totalAmount').textContent.replace('₹', '').trim()) || 0;
            console.log(totalAmount);
            
            initiateOnlinePayment(totalAmount);
        })

        async function initiateOnlinePayment(totalAmount) {
			try {
				const response = await fetch('/user/create-razorpay-order', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ totalAmount, currency: 'INR' })
				});

				const order = await response.json();
				if (response.ok) {
                    console.log('entered to open razor root');
                    
					openRazorpay(order);
				} else {
					alert('Error creating Razorpay order.');
				}
			} catch (error) {
				console.error('Error initiating online payment:', error);
			}
		}
        function openRazorpay(order) {
            console.log('now gona create raxor pay');
            
            const options = {
                key: 'rzp_test_3EYdWsxcryrgrR', 
                amount: order.amount,
                currency: order.currency,
                order_id: order.id,
                handler: verifyPayment,
                prefill: { name: 'Rafan', email: 'rafan123@gmail.com', contact: '8281652046' },
                theme: { color: '#0000' }
            };
            const rzp = new Razorpay(options);
            console.log('raxzorpay mayh workes');
            
            rzp.open();
            console.log(options);
            
        }
        async function verifyPayment(response) {
			const orderId =document.getElementById('orderID').textContent.replace('$', '').trim();
            console.log('fdafsadfas'+orderId);
            
            try {
                const verifyResponse = await fetch('/user/retryPayment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        razorpay_order_id: response.razorpay_order_id,
                        razorpay_payment_id: response.razorpay_payment_id,
                        razorpay_signature: response.razorpay_signature,
                        orderId
                    })
                });

                const result = await verifyResponse.json();
                if (verifyResponse.ok) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Order Placed Successfully!',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        window.location.reload();
                    });
                } else {
                    Swal.fire({
                        icon: 'Error',
                        title: 'Payment Failed',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        window.location.reload();
                    });				}
            } catch (error) {
                console.error('Error verifying payment:', error);
            }
        }
    
    </script>



<!--===============================================================================================-->	
	<script src="/vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/bootstrap/js/popper.js"></script>
	<script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function(){
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
<!--===============================================================================================-->
	<script src="/vendor/daterangepicker/moment.min.js"></script>
	<script src="/vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/slick/slick.min.js"></script>
	<script src="/js/slick-custom.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/parallax100/parallax100.js"></script>
	<script>
        $('.parallax100').parallax100();
	</script>
<!--===============================================================================================-->
	<script src="/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
	<script>
		$('.gallery-lb').each(function() { // the containers for all your galleries
			$(this).magnificPopup({
		        delegate: 'a', // the selector for gallery item
		        type: 'image',
		        gallery: {
		        	enabled:true
		        },
		        mainClass: 'mfp-fade'
		    });
		});
	</script>
<!--===============================================================================================-->
	<script src="/vendor/isotope/isotope.pkgd.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/sweetalert/sweetalert.min.js"></script>
	<script>
		$('.js-addwish-b2').on('click', function(e){
			e.preventDefault();
		});

		$('.js-addwish-b2').each(function(){
			var nameProduct = $(this).parent().parent().find('.js-name-b2').html();
			$(this).on('click', function(){
				swal(nameProduct, "is added to wishlist !", "success");

				$(this).addClass('js-addedwish-b2');
				$(this).off('click');
			});
		});

		$('.js-addwish-detail').each(function(){
			var nameProduct = $(this).parent().parent().parent().find('.js-name-detail').html();

			$(this).on('click', function(){
				swal(nameProduct, "is added to wishlist !", "success");

				$(this).addClass('js-addedwish-detail');
				$(this).off('click');
			});
		});

		/*---------------------------------------------*/

		$('.js-addcart-detail').each(function(){
			var nameProduct = $(this).parent().parent().parent().parent().find('.js-name-detail').html();
			$(this).on('click', function(){
				swal(nameProduct, "is added to cart !", "success");
			});
		});
	
	</script>
<!--===============================================================================================-->
	<script src="/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function(){
			$(this).css('position','relative');
			$(this).css('overflow','hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function(){
				ps.update();
			})
		});
	</script>
<!--===============================================================================================-->
	<script src="/js/main.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



</body>
</html>